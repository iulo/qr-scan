var ae=Object.defineProperty,se=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var V=(a,e,s)=>e in a?ae(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,j=(a,e)=>{for(var s in e||(e={}))ne.call(e,s)&&V(a,s,e[s]);if(U)for(var s of U(e))ce.call(e,s)&&V(a,s,e[s]);return a},N=(a,e)=>se(a,oe(e));import{d as ie,a as I,u as F,i as re,o as b,c as H,b as d,t as le,e as de,p as z,f as G,r as y,g as ue,h as fe,w as P,v as q,j as pe,k as ve,l as he,m as _e,n as me,q as ge,s as ye,V as we}from"./vendor.47f10e22.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerpolicy&&(o.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?o.credentials="include":t.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}};ke();const K=ie("global",{state:()=>({scanText:""}),actions:{setScanText(a){this.scanText=a}}});var O=(a,e)=>{const s=a.__vccOpts||a;for(const[c,t]of e)s[c]=t;return s};const Se=a=>(z("data-v-acc410f4"),a=a(),G(),a),be={class:"main"},xe={class:"content is-normal"},Ce=Se(()=>d("h3",null,"scan result",-1)),Me={class:"block scan-result"},Ee=I({name:"Home",setup(a){const e=F(),s=K(),c=re.exports.useToast(),t=()=>{e.push("/scan")},o=async()=>{await navigator.clipboard.writeText(s.scanText),c.success("success copied!",{position:"top",duration:1500})};return(u,C)=>(b(),H("div",be,[d("div",xe,[Ce,d("p",Me,le(de(s).scanText),1)]),d("div",{class:"action"},[d("button",{class:"button is-primary is-medium is-fullwidth",onClick:t},"Scan"),d("button",{class:"button is-info is-medium is-fullwidth",onClick:o},"Copy")])]))}});var Te=O(Ee,[["__scopeId","data-v-acc410f4"]]);function We(){return new Worker("/assets/video-worker.2ba4a3fb.js",{type:"module"})}function Re(){return new Worker("/assets/decode-worker.5da45328.js",{type:"module"})}const Ie=a=>(z("data-v-49a114c3"),a=a(),G(),a),He={class:"scanner"},Oe=Ie(()=>d("div",{class:"square"},[d("div",{class:"scan-line"})],-1)),De=["width"],$e=["width","height"],Ae=I({name:"Scanner",props:{frontCamera:{type:Boolean,default:!1}},emits:["media-error","onsuccess"],setup(a,{emit:e}){const s=a;let c=0;typeof MediaStream.prototype.getVideoTracks=="function"&&window.ImageCapture!==void 0&&(c=0);let t,o,u=!0,C,M,p;const r=y({width:document.documentElement.clientWidth*2,height:document.documentElement.clientHeight*2}),X=y(document.documentElement.clientWidth),Y=y(0);let m=0,g=0;const n=y(),E=y();let w=null,k=0,D=0,h=0,_=0,T=0,W=0;const J=Math.floor(1e3/30);let $=0,R=-1;const Q=async v=>{if(v-$>=J&&n.value&&n.value.readyState===n.value.HAVE_ENOUGH_DATA){if($=v,c===1){const f=await C.grabFrame();o.postMessage({imageBitmap:f},[f])}else if(w&&n.value&&(w.drawImage(n.value,T,W,h,_,0,0,r.value.width,r.value.height),u)){u=!1;const f=w.getImageData(0,0,r.value.width,r.value.height);t.postMessage({imageData:f},[f.data.buffer])}}A()},A=()=>{R=requestAnimationFrame(Q)},Z=async function(){if(navigator.mediaDevices&&typeof navigator.mediaDevices.getUserMedia=="function"){const v=i=>{o&&o.terminate(),M=E.value.transferControlToOffscreen();const S=i.getVideoTracks()[0];C=new window.ImageCapture(S),o=new We,o.addEventListener("message",te=>{e("onsuccess",te.data.data)}),o.postMessage({offscreen:M,imageConfig:{x:T,y:W,width:h,height:_}},[M])},f=()=>{var i,l;w=(l=(i=E.value)==null?void 0:i.getContext("2d"))!=null?l:null,t&&t.terminate(),t=new Re,t.addEventListener("message",S=>{S.data?(e("onsuccess",S.data.data),L()):u=!0})},B=async i=>{var l;!n.value||(p=i,(l=n.value)!=null&&l.srcObject?n.value.src=URL.createObjectURL(i):n.value.srcObject=i,await n.value.play(),m=n.value.videoWidth,g=n.value.videoHeight,k=r.value.width/r.value.height,D=m/g,console.log("videoSize",m,g,r.value.width,r.value.height),D>k?(_=g,h=Math.floor(_*k),T=Math.floor((m-h)/2)):(h=m,_=Math.floor(h/k),W=Math.floor((g-_)/2)),c===1?v(i):f(),A())},ee=s.frontCamera?"user":{exact:"environment"};try{const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:ee,width:{ideal:1280},height:{ideal:720}}});B(i)}catch{try{const l=await navigator.mediaDevices.getUserMedia({video:!0});B(l)}catch(l){e("media-error",l)}}}},L=()=>{o&&o.terminate(),t&&t.terminate(),p&&(typeof(p==null?void 0:p.stop)=="function"?p.stop():p.getTracks().forEach(v=>v.stop())),R>-1&&cancelAnimationFrame(R)};return ue(async()=>{Y.value=parseInt(window.getComputedStyle(n.value).height),await Z()}),fe(async()=>{L()}),(v,f)=>(b(),H("div",He,[Oe,P(d("video",{class:"video",ref_key:"videoElRef",ref:n,width:X.value,playsinline:""},null,8,De),[[q,!0]]),P(d("canvas",{ref_key:"canvasElRef",ref:E,width:r.value.width,height:r.value.height,class:"canvas"},null,8,$e),[[q,!0]])]))}});var Le=O(Ae,[["__scopeId","data-v-49a114c3"]]);const Be={beforeRouteEnter(a,e,s){console.log(e),e.href?s():s("/")}},Ue=I(N(j({},Be),{name:"Scan",setup(a){const e=K(),s=F(),c=t=>{e.setScanText(t),s.back()};return(t,o)=>(b(),pe(Le,{onOnsuccess:c}))}})),Ve=[{path:"/",component:Te},{path:"/scan",component:Ue},{path:"/:pathMatch(.*)*",redirect:"/"}],je=ve({history:he(),routes:Ve});const Ne={},Pe={class:"app"};function qe(a,e){const s=_e("router-view");return b(),H("div",Pe,[me(s)])}var Fe=O(Ne,[["render",qe]]);const x=ge(Fe);x.use(je);x.use(ye());x.use(we);x.mount("#app");
